<html><head>
  <title>Evernote Export</title>
  <basefont face="맑은 고딕 Semilight" size="2">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="exporter-version" content="Evernote Windows/308489 (ko-KR, DDL); Windows/10.0.0 (Win64);">
  <style>
    body, td {
      font-family: 맑은 고딕 Semilight;
      font-size: 10pt;
    }
  </style>

    <link rel="stylesheet" href="Check_MK3_files/style.css">

   <!-- Global site tag (gtag.js) - Google Analytics -->
<script type="text/javascript" async="" src="Check_MK3_files/analytics.js"></script><script async="" src="Check_MK3_files/js"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-138982878-1');
</script>


</head>
<body>

  <h1 id="js_main"><a href="index.html" title="WEB Home">WEB - 코딩무료강의</a></h1>
  <div id="grid">
    <ol>
      <li><a href="1.html" class="saw">HTML</a></li>
      <li><a href="2.html" class="saw" id="active">CSS</a></li>
      <li><a href="3.html">JavasCript</a></li>
      <li><a href="Check_MK1.html">mod_python</a></li>
	  <li><a href="Check_MK2.html">plugin_init</a></li>
      <li><a href="Check_MK3.html">page_handlers</a></li>
    <div id="article">


<a name="16964">

</a><div><a name="16964">
<span><div>URL" 이 page handlers에 맵핑되는 과정 분석</div><div><br></div><div>"side.py URL"이 "page plugin"에 의해서 page handlers 로 연결되는 과정 분석</div><div><br></div></span></a><div><a name="16964">- URL:&nbsp;</a><a href="http://172.16.30.93/sjopen/check_mk/side.py">http://172.16.30.93/sjopen/check_mk/side.py</a></div><div>- .py 이 포함된 요청은 mod_python 설정에서 index.py 모듈의 handler() 함수를 호출</div><div>- shipped.py Plugin 모듈에서 /side.py URL의 헨들러는 sidebar.py 임을 찼는다.(routing)</div><div>- 헨들러인 sidebar.py 모듈에 HTML page를 렌더링하는 코드가 들어있다.(Tag를 출력하고 Div 로 구획을 나누고, html.write로 문자를 출력한다)</div><div><br></div><div><br></div><div><span style="font-family: &quot;맑은 고딕&quot;;">def handler(mod_python_req, fields = None, is_profiling = False):</span></div><div><span style="font-family: &quot;맑은 고딕&quot;;">&nbsp; &nbsp; &nbsp; -&gt;</span> <span style="font-family: &quot;맑은 고딕&quot;;">modules.load_all_plugins()</span></div><div><span style="font-family: &quot;맑은 고딕&quot;;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -&gt; def load_all_plugins()</span></div><div><span style="font-family: &quot;맑은 고딕&quot;;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -&gt; pagehandlers.update(pagetypes.page_handlers())</span></div><div><span style="font-family: &quot;맑은 고딕&quot;;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -&gt;&nbsp;</span> <span style="font-family: &quot;맑은 고딕&quot;;">page_handlers.update(page_type.page_handlers())</span></div><div><br></div><div>index.py -&gt; handler() -&gt;&nbsp;<span style="font-family: &quot;맑은 고딕&quot;;">modules.load_all_plugins() -&gt; execfile() -&gt; plugins/pages/</span><span style="font-family: &quot;맑은 고딕&quot;;">shipped.pagehandlers[] -&gt; side : sidebar.page_side -&gt;</span> <span style="color: rgb(255, 0, 0); font-family: &quot;맑은 고딕&quot;;">sidebar.py</span><span style="font-family: &quot;맑은 고딕&quot;;">&nbsp;파일의 page_side()</span></div><div><br></div><div><span style="font-weight: bold;">n. 호출한&nbsp;</span><span style="font-weight: bold;">URL 을&nbsp;</span><span style="font-weight: bold;">plugins/pages/shipped.py 에서 찼는다. URL 과 page handler 사이를 맵핑한 딕셔너리</span></div><div><span style="font-family: &quot;맑은 고딕&quot;;">modules.load_all_plugins() -&gt; exec()&nbsp; (import 와 달리 plugin 파일을 실행시킨다, Debug 할때 주의하자)</span></div><div><span style="font-weight: bold;"><span style="font-weight: bold; color: rgb(255, 0, 0);">/omd/sites/sjopen/share/check_mk/web/plugins/pages/shipped.py</span>&nbsp;&nbsp;</span><span style="font-weight: bold;">&nbsp; -&gt;&nbsp;</span><span style="font-weight: bold;">Import modules that contain the page functions</span></div><div><span style="font-family: 굴림체; font-weight: bold;">&nbsp; &nbsp; pagehandlers.update({&nbsp; &nbsp; &nbsp;==&gt;&nbsp;&nbsp;</span><span style="font-weight: bold;">URL 을 key 로 page rendering 가 저장되어 있음</span></div><div><span style="font-family: 굴림체; font-weight: bold;">&nbsp;
 &nbsp; &nbsp; &nbsp;"index"&nbsp; &nbsp; &nbsp; :
main.page_index,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ==&gt; main.py
파일의&nbsp;</span><span style="font-family: 굴림체; font-weight: bold;">page_index()</span></div><div><span style="font-family: 굴림체; font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp;</span><span style="font-family: 굴림체; font-weight: bold;">"side"&nbsp; &nbsp; &nbsp; &nbsp;: sidebar.page_side,&nbsp; &nbsp; &nbsp; &nbsp; ==&gt;&nbsp;</span><span style="font-family: 굴림체; font-weight: bold;">sidebar.py 파일의&nbsp;</span><span style="font-family: 굴림체; font-weight: bold;">page_side()</span></div><div><span style="font-family: 굴림체; font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp;</span><span style="font-family: 굴림체; font-weight: bold;">"dashboard"&nbsp; : dashboard.page_dashboard, ==&gt; dashboard.py 파일의&nbsp;</span><span style="font-family: 굴림체; font-weight: bold;">page_dashboard()</span></div><div><span style="font-family: 굴림체; font-weight: bold;">&nbsp; &nbsp; &nbsp; &nbsp;</span><span style="font-family: 굴림체; font-weight: bold;">"view"&nbsp; &nbsp; &nbsp; &nbsp;: views.page_view,</span></div><div><br></div><div><span style="font-family: 바탕체; font-weight: bold;">&nbsp;</span><span style="font-family: 바탕체; font-weight: bold;"><img src="Check_MK3_files/Image.png" type="image/png" data-filename="Image.png" width="792"></span></div><div><span style="font-weight: bold;">/omd/sites/sjopen/share/check_mk/web/plugins/sidebar/shipped.py</span></div><div><span style="font-weight: bold;">/omd/sites/sjopen/share/check_mk/web/plugins/sidebar/</span><span style="font-weight: bold;">wato.py</span></div><div><span style="font-weight: bold;">/omd/sites/sjopen/share/check_mk/web/plugins/sidebar/</span><span style="font-weight: bold;">search.py</span></div><div><span style="font-weight: bold;">/omd/sites/sjopen/share/check_mk/web/plugins/sidebar/</span><span style="font-weight: bold;">nagvis_maps.py</span></div><div><span style="font-weight: bold;">/omd/sites/sjopen/share/check_mk/web/plugins/sidebar/</span><span style="font-weight: bold;">mkeventd.py</span></div><div><span style="font-weight: bold;">/omd/sites/sjopen/share/check_mk/web/plugins/sidebar/</span><span style="font-weight: bold;">bi.py</span></div><div><br></div><div><span style="font-family: &quot;맑은 고딕&quot;; font-weight: bold;">n. side.py 의 핸들러인 sidebar.py 에서&nbsp;</span><span style="font-family: &quot;맑은 고딕&quot;; font-weight: bold;">html.html_head(_("Check_MK Sidebar") 구현 확인</span></div><div>/omd/sites/sjopen/share/check_mk/web/htdocs/sidebar.py</div><div>def heading(text):</div><div>def sidebar_head():</div><div>def render_messages():</div><div>def sidebar_foot():</div><div>def page_side():</div><div>&nbsp;&nbsp;&nbsp;&nbsp;if not config.user.may("general.see_sidebar"):</div><div>&nbsp;&nbsp;&nbsp;&nbsp;if config.sidebar_notify_interval is not None:</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interval = config.sidebar_notify_interval</div><div>&nbsp;&nbsp;&nbsp;&nbsp;html.html_head(_("<span style="color: rgb(255, 0, 0);">Check_MK Sidebar</span>"), javascripts=["sidebar"], stylesheets=["sidebar", "status"])</div><div>&nbsp;&nbsp;&nbsp;&nbsp;html.write('&lt;body class="<span style="color: rgb(255, 0, 0);">side</span>')</div><div><br></div><div><span style="font-weight: bold;">n. 우측 상단의 Check_MK Log 제거하기</span></div><div><span style="font-weight: bold;">- 이미지를 출력하지 않도록 html.img 메소드를 삭제하면 Log가 사라진다.</span></div><div>- html.write() 메소드로 원하는 HTML TAG 추가하며 원하는 내용이 출력된다.</div><div>def sidebar_head():</div><div>&nbsp;&nbsp;&nbsp;&nbsp;html.open_div(id_="side_header")</div><div>&nbsp;&nbsp;&nbsp;&nbsp;html.div('', id_="side_fold")</div><div>&nbsp;&nbsp;&nbsp;&nbsp;html.open_a(href=config.user.get_attribute("start_url") or config.start_url,</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target="main",
 title=_("Go to main overview"))</div><div>&nbsp;&nbsp;&nbsp;&nbsp;######### html.img(src="images/sidebar_top.png", id_="side_bg")</div><div>&nbsp;&nbsp;&nbsp;&nbsp;html.write("&lt;h1&gt;This is KTS NIS&lt;/h1&gt;")&nbsp; # 테스트로 추가한 내용</div><div>&nbsp;&nbsp;&nbsp;&nbsp;html.open_div(id_="side_version")</div><div>&nbsp;&nbsp;&nbsp;&nbsp;html.open_a(href="version.py", target="main", title=_("Open release notes"))</div><div>&nbsp;&nbsp;&nbsp;&nbsp;html.write(get_check_mk_edition_title())</div><div>&nbsp;&nbsp;&nbsp;&nbsp;html.br()</div><div>&nbsp;&nbsp;&nbsp;&nbsp;html.write(cmk.__version__)</div><div><br></div><div>&nbsp;&nbsp;&nbsp;&nbsp;if werks.may_acknowledge():</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;num_unacknowledged_werks = werks.num_unacknowledged_incompatible_werks()</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if num_unacknowledged_werks:</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;html.span(num_unacknowledged_werks,
 class_="unack_werks",</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title=_("%d
 unacknowledged incompatible werks") % num_unacknowledged_werks)</div><div>&nbsp;&nbsp;&nbsp;&nbsp;html.close_a()</div><div>&nbsp;&nbsp;&nbsp;&nbsp;html.close_div()</div><div>&nbsp;&nbsp;&nbsp;&nbsp;html.close_a()</div><div>&nbsp;&nbsp;&nbsp;&nbsp;html.close_div()</div><div><br></div><div><img src="Check_MK3_files/Image%25201.png" type="image/png" data-filename="Image.png" width="220">&nbsp;<img src="Check_MK3_files/Image%25202.png" type="image/png" data-filename="Image.png" width="231"></div><div><br></div><div><br></div><div>n.&nbsp;<span style="font-weight: bold;">shipped.py 플러그인 모듈에 정의된 tacticaloverview 살펴보기</span></div><div><span style="font-weight: bold;"><img src="Check_MK3_files/Image%25203.png" type="image/png" data-filename="Image.png"></span></div><div>/omd/sites/sjopen/share/check_mk/web/plugins/sidebar/shipped.py</div><div><br></div><div><span style="font-family: 바탕체;">sidebar_snapins["tactical_overview"] = {</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;"title" : _("Tactical Overview"),</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;"description" : _("The total number of hosts and service with and without problems"),</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;"refresh" : True,</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;"render" : render_tactical_overview,</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;"allowed" : [ "user", "admin", "guest" ],</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;"styles" : snapin_tactical_overview_styles,</span></div><div><span style="font-family: 바탕체;">}</span></div><div><br></div><div><span style="font-family: 바탕체;">def render_tactical_overview(extra_filter_headers="", extra_url_variables=None):</span></div><div><span style="font-family: 바탕체;">......</span></div><div><span style="font-family: 바탕체;">sidebar_snapins["tactical_overview"] = {</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;"title" : _("Tactical Overview"),</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;"description" : _("The total number of hosts and service with and without problems"),</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;"refresh" : True,</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;"render" : render_tactical_overview,</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;"allowed" : [ "user", "admin", "guest" ],</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;"styles" : snapin_tactical_overview_styles,</span></div><div><span style="font-family: 바탕체;">....</span></div><div><span style="font-family: 바탕체;">html.open_table(class_=["content_center", "tacticaloverview"], cellspacing=2, cellpadding=0, border=0)</span></div><div><span style="font-family: 바탕체;">....</span></div><div><span style="font-family: 바탕체;">for row in rows:</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;if row["what"] == "event":</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount, problems, unhandled_problems = row["data"]</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stales = 0</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# no events open and disabled in local site: don't show events</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if amount == 0 and not config.mkeventd_enabled:</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;continue</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;else:</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;amount, problems, unhandled_problems, stales = row["data"]</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;html.open_tr()</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;html.th(row["title"])</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;html.th(_("Problems"))</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;html.th(_("Unhandled"))</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;if td_class == 'col4':</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;html.th(_("Stale"))</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;html.close_tr()</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;html.open_tr()</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;url = html.makeuri_contextless(row["views"]["all"] + extra_url_variables,filename="view.py")</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;html.open_td(class_=["total", td_class])</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;html.a(amount, href=url, target="main")</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;html.close_td()</span></div><div><br></div><div><br></div><div><span style="font-weight: bold;">n. view.py 에 대한 분석</span></div><div><br></div><div><span style="font-family: &quot;맑은 고딕&quot;;">-&nbsp;view 요청에 대한 헨들러인 page_view 를 분석해보자.</span></div><div><span style="font-family: &quot;맑은 고딕&quot;;">- plugin 초기화를 과정에서 여러 종류의 딕셔너리 데이터들이 선언된다.&nbsp;</span></div><div><span style="font-family: &quot;맑은 고딕&quot;;">&nbsp; &nbsp;/omd/sites/sjopen/share/check_mk/web/plugins/views/datasources.py</span></div><div><br></div><div><br></div><div><span style="font-family: 굴림체; font-weight: bold;">"view"&nbsp; &nbsp; &nbsp; &nbsp;: views.page_view</span></div><div><br></div><div><span style="font-family: 바탕체;">def page_view():</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;bi.reset_cache_status() # needed for status icon</span></div><div><br></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;load_views()</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;view_name = html.var("view_name")</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;if view_name == None:</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise MKGeneralException(_("Missing the variable view_name in the URL."))</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;view = available_views.get(view_name)</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;if not view:</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise
 MKGeneralException(_("No view defined with the name '%s'.") %
html.attrencode(view_name))</span></div><div><br></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;# Gather the page context which is needed for the "add to visual" popup menu</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;# to add e.g. views to dashboards or reports</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;datasource = multisite_datasources[view['datasource']]</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;context = visuals.get_context_from_uri_vars(datasource['infos'])</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;context.update(visuals.get_singlecontext_html_vars(view))</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;html.set_page_context(context)</span></div><div><br></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;prepare_painter_options(view_name)</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;painter_options.update_from_url(view)</span></div><div><br></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;show_view(view, True, True, True)</span></div><div><br></div><div><br></div><div><span style="font-family: 바탕체;"># Load all views - users or builtins</span></div><div><span style="font-family: 바탕체;">def load_views():</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;global multisite_views, available_views</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;# Skip views which do not belong to known datasources</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;multisite_views = visuals.load('views', multisite_builtin_views,</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;skip_func
 = lambda v: v['datasource'] not in multisite_datasources)</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;available_views = visuals.available('views', multisite_views)</span></div><div><span style="font-family: 바탕체;">&nbsp;&nbsp;&nbsp;&nbsp;transform_old_views()</span></div><div><br></div><div><br></div><div><br></div>
</div></div></div></body></html>
